pipeline {
    agent any
    tools {
        maven 'MAVEN'
    }
    environment {
            DOCKER_LOGIN_CREDENTIALS="credentials("docker-jenkins")"
    }

stages {
  stage('Checkout') {
    steps {
        checkout scmGit(branches: [[name: '*/main']], extensions: [], userRemoteConfigs: [[credentialsId: 'cdf86869-645d-4c18-bbac-8fcb3da77ffc', url: 'https://github.com/jagginb/Hello-World.git']])
    }
  }

  stage('Build ') {
    steps {
        sh 'mvn clean install'
        sh 'docker build -t jagginb/docker:$BUILD_NUMBER .'
    }
  }

  stage('Docker login and Docker push') {
    steps {
        sh 'echo $DOCKER_CREDENTIALS_PSW | docker login -u $DOCKER_CREDENTIALS_USR --password-stdin'
        sh 'docker push jagginb/docker:$BUILD_NUMBER'
     
    }
  }

  stage('Docker deploy') {
    steps {
        sh "docker run -itd -p 82:8080 jagginb/docker:$BUILD_NUMBER"
      
    }
  }
 }
}
  